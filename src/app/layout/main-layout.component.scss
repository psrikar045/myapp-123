@import '../styles/bootstrap-mixins';

// Main layout styles with proper space segregation
.main-layout {
  position: absolute;
  min-height: 100vh;
  background-color: var(--bs-body-bg);
  color: var(--bs-body-color);
  z-index: 1;
  overflow-x: hidden;
  width: 100%;
  box-sizing: border-box;
  
  // Ensure proper layering during zoom
  @media screen and (min-resolution: 120dpi), 
         screen and (-webkit-min-device-pixel-ratio: 1.25) {
    z-index: 1;
  }
  
  @media screen and (min-resolution: 192dpi),
         screen and (-webkit-min-device-pixel-ratio: 2) {
    z-index: 1;
  }
}

// Content wrapper that adjusts based on sidenav state
.content-wrapper {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  transition: margin-left 0.3s ease;
  overflow-x: hidden;
  box-sizing: border-box;
  position: relative;
  z-index: 1; // Ensure proper layering
  
  // Default state - no sidenav, full width
  margin-left: 0;
  width: 100%;
  
  // When sidenav is present and not in overlay mode (desktop)
  &.with-sidenav {
    @include media-breakpoint-up(lg) {
      // Expanded state
      &.sidenav-expanded {
        margin-left: 280px;
        width: calc(100% - 280px);
        max-width: calc(100vw - 280px);
        transition: margin-left 0.3s ease, width 0.3s ease, max-width 0.3s ease;
      }
      
      // Collapsed state
      &.sidenav-collapsed {
        margin-left: 70px;
        width: calc(100% - 70px);
        max-width: calc(100vw - 70px);
        transition: margin-left 0.3s ease, width 0.3s ease, max-width 0.3s ease;
      }
    }
  }
  
  // Mobile/tablet responsive - overlay mode, full width
  @include media-breakpoint-down(lg) {
    margin-left: 0;
    width: 100%;
    
    // Add backdrop when sidenav is open on mobile
    &.with-sidenav {
      &::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: calc(var(--sidenav-z-index) - 1);
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        pointer-events: none;
      }
      
      &.sidenav-overlay-active::before {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
      }
    }
  }
}

.main-header {
  // Header is now fixed positioned, no need for relative positioning
  flex-shrink: 0;
  width: 100%;
  height: 0; // Don't take up layout space since header is fixed
}

.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  width: 100%;
  overflow-y: auto;
  overflow-x: hidden;
  box-sizing: border-box;
  position: relative;
  z-index: 1; // Ensure proper layering
  
  &.with-header {
    padding-top: 72px; /* Account for fixed header height */
    min-height: calc(100vh - 72px);
  }
  
  &.with-footer {
    padding-bottom: 0; /* Footer handles its own spacing */
  }
  
  // Ensure proper layering during zoom
  @media screen and (min-resolution: 120dpi), 
         screen and (-webkit-min-device-pixel-ratio: 1.25) {
    z-index: 1;
  }
  
  @media screen and (min-resolution: 192dpi),
         screen and (-webkit-min-device-pixel-ratio: 2) {
    z-index: 1;
  }
}

.main-footer {
  flex-shrink: 0;
  width: 100%;
}

// Responsive and zoom support
@media (max-width: 991.98px) {
  .content-wrapper.with-sidenav {
    margin-left: 0;
    width: 100%;
  }
  
  .navbar.with-sidenav-expanded,
  .navbar.with-sidenav-collapsed {
    left: 0;
    width: 100%;
  }
}

// Zoom level support - handle different zoom levels
@media screen and (min-resolution: 120dpi), 
       screen and (-webkit-min-device-pixel-ratio: 1.25) {
  .content-wrapper {
    &.with-sidenav {
      @include media-breakpoint-up(lg) {
        &.sidenav-expanded {
          margin-left: 280px;
          width: calc(100% - 280px);
          max-width: calc(100vw - 280px); // Prevent overflow
        }
        
        &.sidenav-collapsed {
          margin-left: 70px;
          width: calc(100% - 70px);
          max-width: calc(100vw - 70px); // Prevent overflow
        }
      }
    }
  }
  
  .navbar {
    &.with-sidenav-expanded {
      @include media-breakpoint-up(lg) {
        left: 280px;
        width: calc(100% - 280px);
      }
    }
    
    &.with-sidenav-collapsed {
      @include media-breakpoint-up(lg) {
        left: 70px;
        width: calc(100% - 70px);
      }
    }
  }
}

// High zoom levels (150%+)
@media screen and (min-resolution: 192dpi),
       screen and (-webkit-min-device-pixel-ratio: 2) {
  .content-wrapper {
    &:not(.with-sidenav) {
      margin-left: 0;
      width: 100%;
      max-width: 100vw; // Prevent overflow
    }
    
    &.with-sidenav {
      @include media-breakpoint-up(lg) {
        &.sidenav-expanded {
          margin-left: 280px;
          width: calc(100% - 280px);
          max-width: calc(100vw - 280px); // Prevent overflow
        }
        
        &.sidenav-collapsed {
          margin-left: 70px;
          width: calc(100% - 70px);
          max-width: calc(100vw - 70px); // Prevent overflow
        }
      }
    }
  }
  
  .navbar {
    &:not(.with-sidenav-expanded):not(.with-sidenav-collapsed) {
      left: 0;
      width: 100%;
    }
  }
}

// Theme-specific adjustments
[data-bs-theme="dark"] {
  .main-layout {
    background-color: var(--bs-dark);
    color: var(--bs-light);
  }
}

// Mobile responsive adjustments
@include media-breakpoint-down(md) {
  .main-content {
    &.with-header {
      padding-top: 60px; /* Smaller header on mobile */
      min-height: calc(100vh - 60px);
    }
  }
}

// Accessibility improvements
@media (prefers-reduced-motion: reduce) {
  .content-wrapper,
  .main-header {
    transition: none;
  }
}

// Print styles
@media print {
  .main-header,
  .main-footer {
    display: none;
  }
  
  .content-wrapper {
    margin-left: 0 !important;
    width: 100% !important;
  }
}
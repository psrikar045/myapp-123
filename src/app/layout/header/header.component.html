<!-- Bootstrap Responsive Navbar -->
<nav class="navbar navbar-expand-lg" 
     [class.navbar-scrolled]="isScrolled"
     [class.navbar-hidden]="!isVisible"
    
     [class.navbar-dark]="currentTheme === 'dark'"
     [attr.data-header-type]="headerType"
     [attr.data-bs-theme]="currentTheme" id="HeaderStyle">
  <div class="container px-lg-5 px-md-4 px-3 pad100">
    <!-- Left Section: Logo and Sidenav Toggle -->
    <div class="header-left d-flex align-items-center justify-content-between">
      
      <!-- Sidenav Toggle Button for Mobile (authenticated users only) -->
      <button class="btn btn-link sidenav-toggle-btn mobile-menu-toggle d-lg-none m-0" 
              type="button" 
              (click)="toggleSidenav()" 
              *ngIf="authService.isAuthenticated()" 
              aria-label="Toggle sidebar navigation">
        <i class="bi-list"
           [class.text-dark]="(sidenavService.config$ | async)?.collapsed"
           [class.text-primary]="!(sidenavService.config$ | async)?.collapsed"></i>
        <i [class.text-dark]="(sidenavService.config$ | async)?.collapsed"
           [class.text-primary]="!(sidenavService.config$ | async)?.collapsed"
           [class.bi-chevron-right]="(sidenavService.config$ | async)?.collapsed"
           [class.bi-chevron-left]="!(sidenavService.config$ | async)?.collapsed"
        ></i>
      </button>
      
      <!-- Mobile Menu Toggle for landing/unauthenticated -->
      <button class="navbar-toggler d-lg-none me-2"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNav"
              aria-controls="navbarNav"
              aria-expanded="false"
              aria-label="Toggle navigation"
              *ngIf="showNavigation && !authService.isAuthenticated()">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Brand/Logo - Always visible -->
      <a class="navbar-brand" (click)="onLogoClick()" style="cursor: pointer;">
        <img [src]="(computedLogo$ | async)?.src" [alt]="(computedLogo$ | async)?.alt" class="logo-img" loading="lazy">
      </a>
      
      <!-- Sidenav Toggle Button for Desktop (authenticated users only) -->
      <button class="btn btn-link sidenav-toggle-btn desktop-toggle me-3 d-none d-lg-block" 
              type="button" 
              (click)="toggleSidenav()" 
              *ngIf="authService.isAuthenticated() && (sidenavService.isVisible$ | async)"
              [attr.aria-label]="(sidenavService.config$ | async)?.collapsed ? 'Expand sidebar' : 'Collapse sidebar'"
              [title]="(sidenavService.config$ | async)?.collapsed ? 'Expand sidebar' : 'Collapse sidebar'">
        <i class="" 
           [class.bi-chevron-right]="(sidenavService.config$ | async)?.collapsed"
           [class.bi-chevron-left]="!(sidenavService.config$ | async)?.collapsed"
           style="font-size: 1.25rem;"></i>
      </button>
      
      <!-- Sidenav Toggle Button for Mobile (authenticated users only) -->
      <!-- <button class="btn btn-link sidenav-toggle-btn mobile-menu-toggle d-lg-none me-2" 
              type="button" 
              (click)="toggleSidenav()" 
              *ngIf="authService.isAuthenticated()" 
              aria-label="Toggle sidebar navigation">
        <i class="bi-list" style="font-size: 1.5rem;"></i>
      </button> -->


    </div>

    <!-- Right-side Mobile Actions (auth only, non-landing) -->
    <div class=" d-flex align-items-center d-lg-none  m-0"
         *ngIf="authService.isAuthenticated() && !isLanding">
      <!-- Upgrade Icon -->
      <button class="btn-sm w-auto px-1 py-0 rounded-circle bg-light border-primary "
              type="button"
              (click)="onUpgradeClick()"
              aria-label="Upgrade">
        <i class="bi bi-currency-dollar text-primary fs-5"></i>
      </button>

      <!-- Profile Icon with Dropdown -->
      <div class=" w-auto p-2 d-flex align-items-center justify-content-center"
      id="mobileProfileDropdown"
      type="button"
      data-bs-toggle="dropdown"
      data-bs-auto-close="outside"
      aria-expanded="false"
      aria-label="Profile menu">
      <img [src]="profileAvatarUrl" alt="User Avatar" class="profile-avatar">
    </div>
    <!-- <div class=" navbar-nav mx-auto "> -->
      <ng-container >
        <ul class="dropdown-menu dropdown-menu-end profile-dropdown me-2" aria-labelledby="mobileProfileDropdown">
          <li *ngIf="!currentRoute.startsWith('/profile')">
            <a class="dropdown-item d-flex align-items-center" href="#" (click)="goToProfile($event)">
              <i class="bi bi-person-circle me-2"></i>
              <span>My Profile</span>
            </a>
          </li>
          <li>
            <a class="dropdown-item d-flex align-items-center" href="#" (click)="logout(); $event.preventDefault()">
              <i class="bi bi-box-arrow-right me-2"></i>
              <span>Logout</span>
            </a>
          </li>
        </ul>
        </ng-container>
      <!-- </div> -->
    </div>

    <!-- Navigation Menu -->
    <div class="collapse navbar-collapse" id="navbarNav" *ngIf="showNavigation">
      
      <!-- Main Navigation Links -->
      <ul class="navbar-nav mx-auto">
        <li class="nav-item" *ngFor="let item of navItems$ | async">
          <a class="nav-link" 
             (click)="onNavClick(item)"
             [class.active]="isNavItemActive(item)"
             role="button">
            {{ item.label }}
          </a>
        </li>
      </ul>

      <!-- Action Buttons -->
      <div class="navbar-nav m-0">
        
        <!-- Theme & Settings Button (Combined) -->
        <!-- <button class="btn btn-link theme-settings-btn me-2" 
                type="button"
                (click)="openThemePanel()"
                aria-label="Open theme & settings panel"
                [title]="isAdvancedThemeAvailable ? 'Theme & Settings (Premium Available)' : 'Theme & Settings'">
          <i class="bi-palette-fill" aria-hidden="true"></i> -->
          <!-- <span class="theme-indicator" *ngIf="isAdvancedThemeAvailable">
            <i class="bi-star-fill"></i>
          </span> -->
        <!-- </button> -->

        <ng-container *ngFor="let action of actions$ | async">
          
          <!-- Upgrade Button -->
          <button *ngIf="action.type === 'upgrade'" 
                  class="btn btn-outline-primary squared-pill me-2 d-flex align-items-center" 
                  (click)="onUpgradeClick()">
            <i class="bi bi-star me-1"></i>
            Upgrade
          </button>

          <!-- Profile Dropdown -->
          <div *ngIf="action.type === 'profile'" class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center" 
               href="#" 
               role="button" 
               data-bs-toggle="dropdown"
               aria-expanded="false"
               id="profileDropdown">
              <img [src]="profileAvatarUrl" 
                   alt="User Avatar" 
                   class="profile-avatar me-2">
              <span class="d-none d-lg-inline">Profile</span>
            </a>
            
            <ul class="dropdown-menu dropdown-menu-end profile-dropdown" aria-labelledby="profileDropdown">
              <li *ngIf="!currentRoute.startsWith('/profile')">
                <a class="dropdown-item d-flex align-items-center" href="#" (click)="goToProfile($event)">
                  <i class="bi bi-person-circle me-2"></i>
                  <span>My Profile</span>
                </a>
              </li>
              <li>
                <a class="dropdown-item d-flex align-items-center" href="#" (click)="logout(); $event.preventDefault()">
                  <i class="bi bi-box-arrow-right me-2"></i>
                  <span>Logout</span>
                </a>
              </li>
            </ul>
          </div>

          <!-- Login Button -->
          <button *ngIf="action.type === 'login'" 
                  (click)="login()" 
                  class="btn btn-outline-primary me-2 header-btn">
            {{ action.label }}
          </button>

          <!-- Get Started Button -->
             <!-- [routerLink]="['/login']" 
                  [queryParams]="{ register: 'true' }"  -->
          <button *ngIf="action.type === 'get-started'" 
                (click)="onGetStartedClick()"
                  class="btn btn-primary header-btn header-btn-primary d-flex align-items-center">
            {{ action.label }}
            <i class="bi bi-arrow-right ms-2"></i>
          </button>
        </ng-container>
      </div>
    </div>
  </div>
</nav>

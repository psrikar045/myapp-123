<div class="set-password-page-wrapper" [class.dark-theme]="isDarkMode">
  <div class="set-password-container" mat-typography>
    <div class="set-password-left">
      <div class="navigation-header">
        <a (click)="back()" class="back-link" i18n="@@backLink">
          <mat-icon>arrow_back</mat-icon> Back
        </a>
      </div>
      <img src="images/logo.svg" alt="TravelWise Logo" class="logo" i18n-alt="@@logoAltText">
      <div class="panel-spacer-top"></div>
      <div class="set-password-panel">
        <h2 i18n="@@setPasswordTitle">Set a password</h2>
        <p class="subtitle" i18n="@@setPasswordSubtitle">Your previous password has been reset. Please set a new password for your account.</p>

        <div *ngIf="errorMessage" class="error-message" role="alert">
          {{ errorMessage }}
        </div>

        <form [formGroup]="setPasswordForm" (ngSubmit)="onSubmit()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label i18n="@@newPasswordLabel">Create Password</mat-label>
            <input matInput [type]="hideNewPassword ? 'password' : 'text'" formControlName="newPassword" placeholder="Enter new password" i18n-placeholder="@@newPasswordPlaceholder" required>
            <button mat-icon-button matSuffix (click)="toggleNewPasswordVisibility()" type="button" [attr.aria-label]="hideNewPassword ? 'Show password' : 'Hide password'" [attr.i18n-aria-label]="hideNewPassword ? '@@showPasswordAriaLabel' : '@@hidePasswordAriaLabel'">
              <mat-icon>{{hideNewPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>
            <mat-error *ngIf="newPassword.hasError('required')" i18n="@@passwordRequiredError">
              New password is required.
            </mat-error>
            <mat-error *ngIf="newPassword.hasError('minlength')" i18n="@@passwordMinLengthError">
              Password must be at least 8 characters long.
            </mat-error>
            <!-- Add other errors for strong password validator if used -->
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label i18n="@@confirmPasswordLabel">Re-enter Password</mat-label>
            <input matInput [type]="hideConfirmPassword ? 'password' : 'text'" formControlName="confirmPassword" placeholder="Confirm new password" i18n-placeholder="@@confirmPasswordPlaceholder" required>
            <button mat-icon-button matSuffix (click)="toggleConfirmPasswordVisibility()" type="button" [attr.aria-label]="hideConfirmPassword ? 'Show password' : 'Hide password'" [attr.i18n-aria-label]="hideConfirmPassword ? '@@showPasswordAriaLabel' : '@@hidePasswordAriaLabel'">
              <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>
            <mat-error *ngIf="confirmPassword.hasError('required')" i18n="@@confirmPasswordRequiredError">
              Please confirm your password.
            </mat-error>
            <mat-error *ngIf="confirmPassword.hasError('passwordMismatch') && !confirmPassword.hasError('required')" i18n="@@passwordsDoNotMatchError">
              Passwords do not match.
            </mat-error>
          </mat-form-field>

          <button mat-raised-button color="primary" type="submit" class="full-width set-password-button" [disabled]="setPasswordForm.invalid || isLoading">
            <span *ngIf="!isLoading" i18n="@@setPasswordButtonText">Set password</span>
            <mat-spinner *ngIf="isLoading" diameter="24" class="button-spinner"></mat-spinner>
          </button>
        </form>

        <!-- Optional: Dark mode toggle if needed -->
        <div class="dark-mode-toggle-container" *ngIf="iconsRegistered">
            <mat-slide-toggle [checked]="(themeService.isDarkMode$ | async)!" (change)="toggleDarkMode()" i18n="@@darkModeLabel">
              Dark Mode
            </mat-slide-toggle>
            <mat-icon svgIcon="moon" class="toggle-icon moon-icon"></mat-icon>
            <mat-icon svgIcon="sun" class="toggle-icon sun-icon"></mat-icon>
        </div>

      </div>
      <div class="panel-spacer-bottom"></div>
    </div>

    <div class="set-password-right">
      <div class="carousel-container">
        <img *ngFor="let image of GALLERY_IMAGE_PATHS; let i = index"
             [src]="image"
             alt="Gallery image {{i + 1}}"
             i18n-alt="@@galleryImageAltText"
             class="carousel-image"
             [class.active]="i === currentImageIndex"
             loading="lazy">
      </div>
    </div>
  </div>
</div>
